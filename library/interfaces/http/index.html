
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="With no prior knowledge of machine learning or device-specific deployment, you can deploy a computer vision model to a range of devices and environments using the Roboflow Inference Server." name="description"/>
<meta content="Roboflow" name="author"/>
<link href="https://roboflow.github.io/inference/library/interfaces/http/" rel="canonical"/>
<link href="../base/" rel="prev"/>
<link href="../../../add_a_model/" rel="next"/>
<link href="https://media.roboflow.com/laptop-lenny.png" rel="icon"/>
<meta content="mkdocs-1.5.2, mkdocs-material-9.1.21" name="generator"/>
<title>HTTP Interface - Roboflow Inference</title>
<link href="../../../assets/stylesheets/main.eebd395e.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../styles.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-T0CED2YY8K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-T0CED2YY8K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-T0CED2YY8K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#http-interface">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Roboflow Inference" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Roboflow Inference">
<img alt="logo" src="https://media.roboflow.com/laptop-lenny.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Roboflow Inference
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              HTTP Interface
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/roboflow/inference" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    roboflow/inference
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Roboflow Inference" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Roboflow Inference">
<img alt="logo" src="https://media.roboflow.com/laptop-lenny.png"/>
</a>
    Roboflow Inference
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/roboflow/inference" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    roboflow/inference
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Quickstart
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quickstart/docker/">
        Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quickstart/http_inference/">
        HTTP Inference
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../api/">
        API Reference
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Library Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Library Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          Models
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
          Models
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/clip/">
        CLIP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/segment_anything/">
        Segment Anything
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/vit_classification/">
        ViT Classification
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/yolov5/">
        YOLOv5 Object Detection
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/yolov8/">
        YOLOv8 Object Detection
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/yolov8_classification/">
        YOLOv8 Classification
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/yolov7_instance_segmentation/">
        YOLOv7 Instance Segmentation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/yolov8_instance_segmentation.md">
        YOLOv8 Instance Segmentation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../models/yoloact_instance_segmentation.md">
        YOLO-ACT Instance Segmentation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Model Managers
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Model Managers
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../model_managers/base/">
        Base Manager
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model_managers/pingback/">
        Pingback Manager
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Model Registries
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Model Registries
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../model_registries/base/">
        Base Registry
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model_registries/roboflow/">
        Roboflow Registry
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Interfaces
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          Interfaces
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../base/">
        Base Interface
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          HTTP Interface
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        HTTP Interface
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface">
    inference.core.interfaces.http.http_api.HttpInterface
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface.__init__">
    __init__()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../add_a_model/">
        Add a Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../contributing/">
        Contributing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../changelog.md">
        Changelog
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface">
    inference.core.interfaces.http.http_api.HttpInterface
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface.__init__">
    __init__()
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="http-interface">HTTP Interface<a class="headerlink" href="#http-interface" title="Permanent link">¶</a></h1>
<div class="doc doc-object doc-class">
<a id="inference.core.interfaces.http.http_api.HttpInterface"></a>
<div class="doc doc-contents first">
<p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="inference.core.interfaces.base.BaseInterface" href="../base/#inference.core.interfaces.base.BaseInterface">BaseInterface</a></code></p>
<p>Roboflow defined HTTP interface for a general-purpose inference server.</p>
<p>This class sets up the FastAPI application and adds necessary middleware,
as well as initializes the model manager and model registry for the inference server.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>app</code></td>
<td>
<code><span title="fastapi.FastAPI">FastAPI</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The FastAPI application instance.</p>
</div>
</td>
</tr>
<tr>
<td><code>model_manager</code></td>
<td>
<code><a class="autorefs autorefs-internal" title="inference.core.managers.base.ModelManager" href="../../model_managers/base/#inference.core.managers.base.ModelManager">ModelManager</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The manager for handling different models.</p>
</div>
</td>
</tr>
<tr>
<td><code>model_registry</code></td>
<td>
<code><a class="autorefs autorefs-internal" title="inference.core.registries.roboflow.RoboflowModelRegistry" href="../../model_registries/roboflow/#inference.core.registries.roboflow.RoboflowModelRegistry">RoboflowModelRegistry</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The registry containing the Roboflow models.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/http/http_api.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HttpInterface</span><span class="p">(</span><span class="n">BaseInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Roboflow defined HTTP interface for a general-purpose inference server.</span>

<span class="sd">    This class sets up the FastAPI application and adds necessary middleware,</span>
<span class="sd">    as well as initializes the model manager and model registry for the inference server.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        app (FastAPI): The FastAPI application instance.</span>
<span class="sd">        model_manager (ModelManager): The manager for handling different models.</span>
<span class="sd">        model_registry (RoboflowModelRegistry): The registry containing the Roboflow models.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_manager</span><span class="p">:</span> <span class="n">ModelManager</span><span class="p">,</span>
        <span class="n">model_registry</span><span class="p">:</span> <span class="n">RoboflowModelRegistry</span><span class="p">,</span>
        <span class="n">root_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initializes the HttpInterface with given model manager and model registry.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_manager (ModelManager): The manager for handling different models.</span>
<span class="sd">            model_registry (RoboflowModelRegistry): The registry containing the Roboflow models.</span>
<span class="sd">            root_path (Optional[str]): The root path for the FastAPI application.</span>

<span class="sd">        Description:</span>
<span class="sd">            Deploy Roboflow trained models to nearly any compute environment!</span>
<span class="sd">        """</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">"Roboflow inference server"</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">terms_of_service</span><span class="o">=</span><span class="s2">"https://roboflow.com/terms"</span><span class="p">,</span>
            <span class="n">contact</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Roboflow Inc."</span><span class="p">,</span>
                <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://roboflow.com/contact"</span><span class="p">,</span>
                <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"help@roboflow.com"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">license_info</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Apache 2.0"</span><span class="p">,</span>
                <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://www.apache.org/licenses/LICENSE-2.0.html"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">root_path</span><span class="o">=</span><span class="n">root_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">METLO_KEY</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
                <span class="n">ASGIMiddleware</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"https://app.metlo.com"</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">METLO_KEY</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ALLOW_ORIGINS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
                <span class="n">CORSMiddleware</span><span class="p">,</span>
                <span class="n">allow_origins</span><span class="o">=</span><span class="n">ALLOW_ORIGINS</span><span class="p">,</span>
                <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
                <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Optionally add middleware for profiling the FastAPI server and underlying inference API code</span>
        <span class="k">if</span> <span class="n">PROFILE</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
                <span class="n">CProfileMiddleware</span><span class="p">,</span>
                <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">server_app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="s2">"/profile/output.pstats"</span><span class="p">,</span>
                <span class="n">strip_dirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">sort_by</span><span class="o">=</span><span class="s2">"cumulative"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">PINGBACK_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">count_errors</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Middleware to count errors.</span>

<span class="sd">                Args:</span>
<span class="sd">                    request (Request): The incoming request.</span>
<span class="sd">                    call_next (Callable): The next middleware or endpoint to call.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Response: The response from the next middleware or endpoint.</span>
<span class="sd">                """</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="n">model_manager</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">num_errors</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="n">model_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span> <span class="o">=</span> <span class="n">model_registry</span>

        <span class="k">def</span> <span class="nf">process_inference_request</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequest</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceResponse</span><span class="p">:</span>
<span class="w">            </span><span class="sd">"""Processes an inference request by calling the appropriate model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (M.InferenceRequest): The request containing model ID and other inference details.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.InferenceResponse: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span>
                <span class="p">)(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">inference_request</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">load_core_model</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequest</span><span class="p">,</span>
            <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">core_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">"""Loads a core model (e.g., "clip" or "sam") into the model manager.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (M.InferenceRequest): The request containing version and other details.</span>
<span class="sd">                api_key (Optional[str]): The API key for the request.</span>
<span class="sd">                core_model (str): The core model type, e.g., "clip" or "sam".</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: The core model ID.</span>
<span class="sd">            """</span>
            <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
                <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
            <span class="n">version_id_field</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">_version_id"</span>
            <span class="n">core_model_id</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">inference_request</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">version_id_field</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">core_model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                    <span class="n">core_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span>
                <span class="p">)(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">core_model_id</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">core_model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">core_model_id</span>

        <span class="n">load_clip_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"clip"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the CLIP model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The CLIP model ID.</span>
<span class="sd">        """</span>

        <span class="n">load_sam_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"sam"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the SAM model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The SAM model ID.</span>
<span class="sd">        """</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ServerVersionInfo</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Root"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Get the server name and version number"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Endpoint to get the server name and version number.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.ServerVersionInfo: The server version information.</span>
<span class="sd">            """</span>
            <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ServerVersionInfo</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
                <span class="n">uuid</span><span class="o">=</span><span class="n">model_manager</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># The current AWS Lambda authorizer only supports path parameters, therefore we can only use the legacy infer route. This case statement excludes routes which won't work for the current Lambda authorizer.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/model/registry"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Get model keys"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Get the ID of each loaded model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">registry</span><span class="p">():</span>
<span class="w">                </span><span class="sd">"""Get the ID of each loaded model in the registry.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ModelManagerKeys: The object containing the IDs of all loaded models.</span>
<span class="sd">                """</span>

                <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/model/add"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Load a model"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Load the model with the given model ID"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">AddModelRequest</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Load the model with the given model ID into the model manager.</span>

<span class="sd">                Args:</span>
<span class="sd">                    request (M.AddModelRequest): The request containing the model ID and optional API key.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ModelManagerKeys: The object containing the IDs of all loaded models.</span>
<span class="sd">                """</span>

                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
                    <span class="n">model_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                        <span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span>
                        <span class="n">model_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/model/remove"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove a model"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Remove the model with the given model ID"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_remove</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClearModelRequest</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Remove the model with the given model ID from the model manager.</span>

<span class="sd">                Args:</span>
<span class="sd">                    request (M.ClearModelRequest): The request containing the model ID to be removed.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ModelManagerKeys: The object containing the IDs of all loaded models.</span>
<span class="sd">                """</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/model/clear"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove all models"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Remove all loaded models"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_clear</span><span class="p">():</span>
<span class="w">                </span><span class="sd">"""Remove all loaded models from the model manager.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ModelManagerKeys: The object containing the IDs of all loaded models (empty set in this case).</span>
<span class="sd">                """</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/object_detection"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">List</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">],</span>
                <span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Object detection infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified object detection model"</span><span class="p">,</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_object_detection</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceRequest</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified object detection model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.ObjectDetectionInferenceRequest): The request containing the necessary details for object detection.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[M.ObjectDetectionInferenceResponse, List[M.ObjectDetectionInferenceResponse]]: The response containing the inference results.</span>
<span class="sd">                """</span>

                <span class="k">return</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/instance_segmentation"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Instance segmentation infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified instance segmentation model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_instance_segmentation</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceRequest</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified instance segmentation model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.InstanceSegmentationInferenceRequest): The request containing the necessary details for instance segmentation.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.InstanceSegmentationInferenceResponse: The response containing the inference results.</span>
<span class="sd">                """</span>

                <span class="k">return</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/classification"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Classification infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified classification model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_classification</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceRequest</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified classification model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.ClassificationInferenceRequest): The request containing the necessary details for classification.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[M.ClassificationInferenceResponse, M.MultiLabelClassificationInferenceResponse]: The response containing the inference results.</span>
<span class="sd">                """</span>

                <span class="k">return</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">CORE_MODELS_ENABLED</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">CORE_MODEL_CLIP_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/clip/embed_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Image Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClipImageEmbeddingRequest</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the OpenAI CLIP model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.ClipImageEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.ClipEmbeddingResponse: The response containing the embedded image.</span>
<span class="sd">                    """</span>
                    <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/clip/embed_text"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Text Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed text data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_text</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClipTextEmbeddingRequest</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds text data using the OpenAI CLIP model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.ClipTextEmbeddingRequest): The request containing the text to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.ClipEmbeddingResponse: The response containing the embedded text.</span>
<span class="sd">                    """</span>
                    <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/clip/compare"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ClipCompareResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Compare"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to compute similarity scores."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_compare</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClipCompareRequest</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Computes similarity scores using the OpenAI CLIP model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.ClipCompareRequest): The request containing the data to be compared.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.ClipCompareResponse: The response containing the similarity scores.</span>
<span class="sd">                    """</span>
                    <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_SAM_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/sam/embed_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">SamEmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to embed image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_embed_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">SamEmbeddingRequest</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.SamEmbeddingResponse or Response: The response containing the embedded image.</span>
<span class="sd">                    """</span>
                    <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/sam/segment_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">SamSegmentationResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Segmentation"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to generate segmenations for image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_segment_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">SamSegmentationRequest</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Generates segmentations for image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.SamSegmentationRequest): The request containing the image to be segmented.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.SamSegmentationResponse or Response: The response containing the segmented image.</span>
<span class="sd">                    """</span>
                    <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

        <span class="k">if</span> <span class="n">LEGACY_ROUTE_ENABLED</span><span class="p">:</span>
            <span class="c1"># Legacy object detection inference path for backwards compatability</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/</span><span class="si">{dataset_id}</span><span class="s2">/</span><span class="si">{version_id}</span><span class="s2">"</span><span class="p">,</span>
                <span class="c1"># Order matters in this response model Union. It will use the first matching model. For example, Object Detection Inference Response is a subset of Instance segmentation inference response, so instance segmentation must come first in order for the matching logic to work.</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">Any</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_infer</span><span class="p">(</span>
                <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset corresponding to the model to use for inference"</span>
                <span class="p">),</span>
                <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset version corresponding to the model to use for inference"</span>
                <span class="p">),</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.4</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The confidence threshold used to filter out predictions"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"json"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'json' or 'image'. If 'json' prediction data is return as a JSON string. If 'image' prediction data is visualized and overlayed on the original input image."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The publically accessible URL of an image to use for inference."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">image_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"base64"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"One of base64 or numpy. Note, numpy input is not supported for Roboflow Hosted Inference."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"If true, labels will be include in any inference visualization."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">mask_decode_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"accurate"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'accurate' or 'fast'. If 'accurate' the mask will be decoded using the original image size. If 'fast' the mask will be decoded using the original mask size. 'accurate' is slower but more accurate."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">tradeoff_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The amount to tradeoff between 0='fast' and 1='accurate'"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">max_detections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mi">300</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The maximum number of detections to return. This is used to limit the number of predictions returned by the model. The model may return more predictions than this number, but only the top `max_detections` predictions will be returned."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.3</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The IoU threhsold that must be met for a box pair to be considered duplicate during NMS"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
                <span class="n">stroke</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"The stroke width used when visualizing predictions"</span>
                <span class="p">),</span>
                <span class="n">countinference</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">True</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"If false, does not track inference against usage."</span><span class="p">,</span>
                    <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">service_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Shared secret used to authenticate requests to the inference server from internal services (e.g. to allow disabling inference usage tracking via the `countinference` query parameter)"</span><span class="p">,</span>
                    <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Legacy inference endpoint for object detection, instance segmentation, and classification.</span>

<span class="sd">                Args:</span>
<span class="sd">                    dataset_id (str): ID of a Roboflow dataset corresponding to the model to use for inference.</span>
<span class="sd">                    version_id (str): ID of a Roboflow dataset version corresponding to the model to use for inference.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    # Other parameters described in the function signature...</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[M.InstanceSegmentationInferenceResponse, M.ObjectDetectionInferenceResponse, M.ClassificationInferenceResponse, M.MultiLabelClassificationInferenceResponse, Any]: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>

                <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">confidence</span> <span class="o">/=</span> <span class="mi">100</span>
                <span class="k">elif</span> <span class="n">confidence</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                    <span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.01</span>

                <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">overlap</span> <span class="o">/=</span> <span class="mi">100</span>

                <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">request_image</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequestImage</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"url"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">"Content-Type"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ContentTypeMissing</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"Request must include a Content-Type header"</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="s2">"multipart/form-data"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]:</span>
                        <span class="n">form_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
                        <span class="n">base64_image_str</span> <span class="o">=</span> <span class="n">form_data</span><span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">.</span><span class="n">file</span>
                        <span class="n">request_image</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequestImage</span><span class="p">(</span>
                            <span class="nb">type</span><span class="o">=</span><span class="s2">"multipart"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">base64_image_str</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="s2">"application/x-www-form-urlencoded"</span>
                        <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                        <span class="ow">or</span> <span class="s2">"application/json"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
                        <span class="n">request_image</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequestImage</span><span class="p">(</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ContentTypeInvalid</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"Invalid Content-Type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">request_model_id</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                            <span class="s2">"lambda"</span>
                        <span class="p">][</span><span class="s2">"model"</span><span class="p">][</span><span class="s2">"endpoint"</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"--"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"rf-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"nu-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                        <span class="s2">"lambda"</span>
                    <span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">countinference</span><span class="p">:</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">service_secret</span> <span class="o">!=</span> <span class="n">ROBOFLOW_SERVICE_SECRET</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MissingServiceSecretError</span><span class="p">(</span>
                                <span class="s2">"Service secret is required to disable inference usage tracking"</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">request_model_id</span> <span class="o">=</span> <span class="n">model_id</span>

                <span class="k">if</span> <span class="n">request_model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)(</span>
                        <span class="n">model_id</span><span class="o">=</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

                <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">get_task_type</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">)</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceRequest</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"instance-segmentation"</span><span class="p">:</span>
                    <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceRequest</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">"mask_decode_mode"</span><span class="p">:</span> <span class="n">mask_decode_mode</span><span class="p">,</span>
                        <span class="s2">"tradeoff_factor"</span><span class="p">:</span> <span class="n">tradeoff_factor</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"classification"</span><span class="p">:</span>
                    <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceRequest</span>

                <span class="n">inference_request</span> <span class="o">=</span> <span class="n">inference_request_type</span><span class="p">(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">request_model_id</span><span class="p">,</span>
                    <span class="n">image</span><span class="o">=</span><span class="n">request_image</span><span class="p">,</span>
                    <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                    <span class="n">iou_threshold</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                    <span class="n">max_detections</span><span class="o">=</span><span class="n">max_detections</span><span class="p">,</span>
                    <span class="n">visualization_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                    <span class="n">visualization_stroke_width</span><span class="o">=</span><span class="n">stroke</span><span class="p">,</span>
                    <span class="n">visualize_predictions</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">args</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">inference_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">inference_response</span><span class="o">.</span><span class="n">visualization</span><span class="p">,</span>
                        <span class="n">media_type</span><span class="o">=</span><span class="s2">"image/jpeg"</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">inference_response</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>
            <span class="c1"># Legacy clear cache endpoint for backwards compatability</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/clear_cache"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_clear_cache</span><span class="p">():</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Clears the model cache.</span>

<span class="sd">                This endpoint provides a way to clear the cache of loaded models.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    str: A string indicating that the cache has been cleared.</span>
<span class="sd">                """</span>
                <span class="k">await</span> <span class="n">model_clear</span><span class="p">()</span>
                <span class="k">return</span> <span class="s2">"Cache Cleared"</span>

            <span class="c1"># Legacy add model endpoint for backwards compatability</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/start/</span><span class="si">{dataset_id}</span><span class="s2">/</span><span class="si">{version_id}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Starts a model inference session.</span>

<span class="sd">                This endpoint initializes and starts an inference session for the specified model version.</span>

<span class="sd">                Args:</span>
<span class="sd">                    dataset_id (str): ID of a Roboflow dataset corresponding to the model.</span>
<span class="sd">                    version_id (str): ID of a Roboflow dataset version corresponding to the model.</span>
<span class="sd">                    api_key (str, optional): Roboflow API Key for artifact retrieval.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    JSONResponse: A response object containing the status and a success message.</span>
<span class="sd">                """</span>
                <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">"status"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                        <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"inference session started from local memory."</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="inference.core.interfaces.http.http_api.HttpInterface.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_manager</span><span class="p">,</span> <span class="n">model_registry</span><span class="p">,</span> <span class="n">root_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.http.http_api.HttpInterface.__init__" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Initializes the HttpInterface with given model manager and model registry.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>model_manager</code></td>
<td>
<code><a class="autorefs autorefs-internal" title="inference.core.managers.base.ModelManager" href="../../model_managers/base/#inference.core.managers.base.ModelManager">ModelManager</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The manager for handling different models.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model_registry</code></td>
<td>
<code><a class="autorefs autorefs-internal" title="inference.core.registries.roboflow.RoboflowModelRegistry" href="../../model_registries/roboflow/#inference.core.registries.roboflow.RoboflowModelRegistry">RoboflowModelRegistry</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The registry containing the Roboflow models.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>root_path</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[str]</code>
</td>
<td>
<div class="doc-md-description">
<p>The root path for the FastAPI application.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="description" open="">
<summary>Description</summary>
<p>Deploy Roboflow trained models to nearly any compute environment!</p>
</details>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/http/http_api.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_manager</span><span class="p">:</span> <span class="n">ModelManager</span><span class="p">,</span>
    <span class="n">model_registry</span><span class="p">:</span> <span class="n">RoboflowModelRegistry</span><span class="p">,</span>
    <span class="n">root_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initializes the HttpInterface with given model manager and model registry.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_manager (ModelManager): The manager for handling different models.</span>
<span class="sd">        model_registry (RoboflowModelRegistry): The registry containing the Roboflow models.</span>
<span class="sd">        root_path (Optional[str]): The root path for the FastAPI application.</span>

<span class="sd">    Description:</span>
<span class="sd">        Deploy Roboflow trained models to nearly any compute environment!</span>
<span class="sd">    """</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">"Roboflow inference server"</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
        <span class="n">terms_of_service</span><span class="o">=</span><span class="s2">"https://roboflow.com/terms"</span><span class="p">,</span>
        <span class="n">contact</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Roboflow Inc."</span><span class="p">,</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://roboflow.com/contact"</span><span class="p">,</span>
            <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"help@roboflow.com"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">license_info</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Apache 2.0"</span><span class="p">,</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://www.apache.org/licenses/LICENSE-2.0.html"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">root_path</span><span class="o">=</span><span class="n">root_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">METLO_KEY</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
            <span class="n">ASGIMiddleware</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"https://app.metlo.com"</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">METLO_KEY</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ALLOW_ORIGINS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
            <span class="n">CORSMiddleware</span><span class="p">,</span>
            <span class="n">allow_origins</span><span class="o">=</span><span class="n">ALLOW_ORIGINS</span><span class="p">,</span>
            <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
            <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># Optionally add middleware for profiling the FastAPI server and underlying inference API code</span>
    <span class="k">if</span> <span class="n">PROFILE</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
            <span class="n">CProfileMiddleware</span><span class="p">,</span>
            <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">server_app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s2">"/profile/output.pstats"</span><span class="p">,</span>
            <span class="n">strip_dirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sort_by</span><span class="o">=</span><span class="s2">"cumulative"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">PINGBACK_ENABLED</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">count_errors</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Middleware to count errors.</span>

<span class="sd">            Args:</span>
<span class="sd">                request (Request): The incoming request.</span>
<span class="sd">                call_next (Callable): The next middleware or endpoint to call.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Response: The response from the next middleware or endpoint.</span>
<span class="sd">            """</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="n">model_manager</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">num_errors</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">response</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="n">model_manager</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span> <span class="o">=</span> <span class="n">model_registry</span>

    <span class="k">def</span> <span class="nf">process_inference_request</span><span class="p">(</span>
        <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Processes an inference request by calling the appropriate model.</span>

<span class="sd">        Args:</span>
<span class="sd">            inference_request (M.InferenceRequest): The request containing model ID and other inference details.</span>

<span class="sd">        Returns:</span>
<span class="sd">            M.InferenceResponse: The response containing the inference results.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span>
            <span class="p">)(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
                <span class="n">api_key</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">inference_request</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_core_model</span><span class="p">(</span>
        <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequest</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">core_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Loads a core model (e.g., "clip" or "sam") into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            inference_request (M.InferenceRequest): The request containing version and other details.</span>
<span class="sd">            api_key (Optional[str]): The API key for the request.</span>
<span class="sd">            core_model (str): The core model type, e.g., "clip" or "sam".</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The core model ID.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="n">version_id_field</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">_version_id"</span>
        <span class="n">core_model_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">inference_request</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">version_id_field</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">core_model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                <span class="n">core_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span>
            <span class="p">)(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">core_model_id</span><span class="p">,</span>
                <span class="n">api_key</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">core_model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">core_model_id</span>

    <span class="n">load_clip_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"clip"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the CLIP model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The CLIP model ID.</span>
<span class="sd">    """</span>

    <span class="n">load_sam_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"sam"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the SAM model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The SAM model ID.</span>
<span class="sd">    """</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">"/"</span><span class="p">,</span>
        <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ServerVersionInfo</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="s2">"Root"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Get the server name and version number"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
<span class="w">        </span><span class="sd">"""Endpoint to get the server name and version number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            M.ServerVersionInfo: The server version information.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ServerVersionInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">uuid</span><span class="o">=</span><span class="n">model_manager</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># The current AWS Lambda authorizer only supports path parameters, therefore we can only use the legacy infer route. This case statement excludes routes which won't work for the current Lambda authorizer.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/model/registry"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Get model keys"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Get the ID of each loaded model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">registry</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Get the ID of each loaded model in the registry.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.ModelManagerKeys: The object containing the IDs of all loaded models.</span>
<span class="sd">            """</span>

            <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/model/add"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Load a model"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Load the model with the given model ID"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">AddModelRequest</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Load the model with the given model ID into the model manager.</span>

<span class="sd">            Args:</span>
<span class="sd">                request (M.AddModelRequest): The request containing the model ID and optional API key.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.ModelManagerKeys: The object containing the IDs of all loaded models.</span>
<span class="sd">            """</span>

            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
                <span class="n">model_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/model/remove"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove a model"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Remove the model with the given model ID"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_remove</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClearModelRequest</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Remove the model with the given model ID from the model manager.</span>

<span class="sd">            Args:</span>
<span class="sd">                request (M.ClearModelRequest): The request containing the model ID to be removed.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.ModelManagerKeys: The object containing the IDs of all loaded models.</span>
<span class="sd">            """</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/model/clear"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove all models"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Remove all loaded models"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_clear</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Remove all loaded models from the model manager.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.ModelManagerKeys: The object containing the IDs of all loaded models (empty set in this case).</span>
<span class="sd">            """</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">ModelManagerKeys</span><span class="p">(</span><span class="n">model_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/object_detection"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">List</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Object detection infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified object detection model"</span><span class="p">,</span>
            <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_object_detection</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceRequest</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified object detection model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (M.ObjectDetectionInferenceRequest): The request containing the necessary details for object detection.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[M.ObjectDetectionInferenceResponse, List[M.ObjectDetectionInferenceResponse]]: The response containing the inference results.</span>
<span class="sd">            """</span>

            <span class="k">return</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/instance_segmentation"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Instance segmentation infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified instance segmentation model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_instance_segmentation</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceRequest</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified instance segmentation model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (M.InstanceSegmentationInferenceRequest): The request containing the necessary details for instance segmentation.</span>

<span class="sd">            Returns:</span>
<span class="sd">                M.InstanceSegmentationInferenceResponse: The response containing the inference results.</span>
<span class="sd">            """</span>

            <span class="k">return</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/classification"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">M</span><span class="o">.</span><span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Classification infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified classification model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_classification</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceRequest</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified classification model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (M.ClassificationInferenceRequest): The request containing the necessary details for classification.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[M.ClassificationInferenceResponse, M.MultiLabelClassificationInferenceResponse]: The response containing the inference results.</span>
<span class="sd">            """</span>

            <span class="k">return</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">CORE_MODELS_ENABLED</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">CORE_MODEL_CLIP_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/clip/embed_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Image Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClipImageEmbeddingRequest</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the OpenAI CLIP model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.ClipImageEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ClipEmbeddingResponse: The response containing the embedded image.</span>
<span class="sd">                """</span>
                <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                    <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/clip/embed_text"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Text Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed text data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_text</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClipTextEmbeddingRequest</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds text data using the OpenAI CLIP model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.ClipTextEmbeddingRequest): The request containing the text to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ClipEmbeddingResponse: The response containing the embedded text.</span>
<span class="sd">                """</span>
                <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                    <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/clip/compare"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">ClipCompareResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Compare"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to compute similarity scores."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_compare</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">ClipCompareRequest</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Computes similarity scores using the OpenAI CLIP model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.ClipCompareRequest): The request containing the data to be compared.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.ClipCompareResponse: The response containing the similarity scores.</span>
<span class="sd">                """</span>
                <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                    <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_SAM_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/sam/embed_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">SamEmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to embed image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_embed_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">SamEmbeddingRequest</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.SamEmbeddingResponse or Response: The response containing the embedded image.</span>
<span class="sd">                """</span>
                <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                    <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/sam/segment_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">SamSegmentationResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Segmentation"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to generate segmenations for image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_segment_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">M</span><span class="o">.</span><span class="n">SamSegmentationRequest</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Generates segmentations for image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.SamSegmentationRequest): The request containing the image to be segmented.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.SamSegmentationResponse or Response: The response containing the segmented image.</span>
<span class="sd">                """</span>
                <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                    <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

    <span class="k">if</span> <span class="n">LEGACY_ROUTE_ENABLED</span><span class="p">:</span>
        <span class="c1"># Legacy object detection inference path for backwards compatability</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/</span><span class="si">{dataset_id}</span><span class="s2">/</span><span class="si">{version_id}</span><span class="s2">"</span><span class="p">,</span>
            <span class="c1"># Order matters in this response model Union. It will use the first matching model. For example, Object Detection Inference Response is a subset of Instance segmentation inference response, so instance segmentation must come first in order for the matching logic to work.</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">M</span><span class="o">.</span><span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">Any</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_infer</span><span class="p">(</span>
            <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset corresponding to the model to use for inference"</span>
            <span class="p">),</span>
            <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset version corresponding to the model to use for inference"</span>
            <span class="p">),</span>
            <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.4</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The confidence threshold used to filter out predictions"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"json"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'json' or 'image'. If 'json' prediction data is return as a JSON string. If 'image' prediction data is visualized and overlayed on the original input image."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The publically accessible URL of an image to use for inference."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">image_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"base64"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"One of base64 or numpy. Note, numpy input is not supported for Roboflow Hosted Inference."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"If true, labels will be include in any inference visualization."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">mask_decode_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"accurate"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'accurate' or 'fast'. If 'accurate' the mask will be decoded using the original image size. If 'fast' the mask will be decoded using the original mask size. 'accurate' is slower but more accurate."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">tradeoff_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The amount to tradeoff between 0='fast' and 1='accurate'"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">max_detections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mi">300</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The maximum number of detections to return. This is used to limit the number of predictions returned by the model. The model may return more predictions than this number, but only the top `max_detections` predictions will be returned."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The IoU threhsold that must be met for a box pair to be considered duplicate during NMS"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(),</span>
            <span class="n">stroke</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"The stroke width used when visualizing predictions"</span>
            <span class="p">),</span>
            <span class="n">countinference</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"If false, does not track inference against usage."</span><span class="p">,</span>
                <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">service_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Shared secret used to authenticate requests to the inference server from internal services (e.g. to allow disabling inference usage tracking via the `countinference` query parameter)"</span><span class="p">,</span>
                <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Legacy inference endpoint for object detection, instance segmentation, and classification.</span>

<span class="sd">            Args:</span>
<span class="sd">                dataset_id (str): ID of a Roboflow dataset corresponding to the model to use for inference.</span>
<span class="sd">                version_id (str): ID of a Roboflow dataset version corresponding to the model to use for inference.</span>
<span class="sd">                api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                # Other parameters described in the function signature...</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[M.InstanceSegmentationInferenceResponse, M.ObjectDetectionInferenceResponse, M.ClassificationInferenceResponse, M.MultiLabelClassificationInferenceResponse, Any]: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">confidence</span> <span class="o">/=</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">confidence</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.01</span>

            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">overlap</span> <span class="o">/=</span> <span class="mi">100</span>

            <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request_image</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequestImage</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"url"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">"Content-Type"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ContentTypeMissing</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Request must include a Content-Type header"</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">"multipart/form-data"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]:</span>
                    <span class="n">form_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
                    <span class="n">base64_image_str</span> <span class="o">=</span> <span class="n">form_data</span><span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">.</span><span class="n">file</span>
                    <span class="n">request_image</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequestImage</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">"multipart"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">base64_image_str</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="s2">"application/x-www-form-urlencoded"</span>
                    <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                    <span class="ow">or</span> <span class="s2">"application/json"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
                    <span class="n">request_image</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InferenceRequestImage</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ContentTypeInvalid</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Invalid Content-Type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                <span class="n">request_model_id</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                        <span class="s2">"lambda"</span>
                    <span class="p">][</span><span class="s2">"model"</span><span class="p">][</span><span class="s2">"endpoint"</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"--"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"rf-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"nu-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                    <span class="s2">"lambda"</span>
                <span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">countinference</span><span class="p">:</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">service_secret</span> <span class="o">!=</span> <span class="n">ROBOFLOW_SERVICE_SECRET</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MissingServiceSecretError</span><span class="p">(</span>
                            <span class="s2">"Service secret is required to disable inference usage tracking"</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">request_model_id</span> <span class="o">=</span> <span class="n">model_id</span>

            <span class="k">if</span> <span class="n">request_model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

            <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">get_task_type</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">)</span>
            <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">ObjectDetectionInferenceRequest</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"instance-segmentation"</span><span class="p">:</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">InstanceSegmentationInferenceRequest</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"mask_decode_mode"</span><span class="p">:</span> <span class="n">mask_decode_mode</span><span class="p">,</span>
                    <span class="s2">"tradeoff_factor"</span><span class="p">:</span> <span class="n">tradeoff_factor</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"classification"</span><span class="p">:</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">ClassificationInferenceRequest</span>

            <span class="n">inference_request</span> <span class="o">=</span> <span class="n">inference_request_type</span><span class="p">(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">request_model_id</span><span class="p">,</span>
                <span class="n">image</span><span class="o">=</span><span class="n">request_image</span><span class="p">,</span>
                <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                <span class="n">iou_threshold</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                <span class="n">max_detections</span><span class="o">=</span><span class="n">max_detections</span><span class="p">,</span>
                <span class="n">visualization_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">visualization_stroke_width</span><span class="o">=</span><span class="n">stroke</span><span class="p">,</span>
                <span class="n">visualize_predictions</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
                <span class="o">**</span><span class="n">args</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">inference_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">inference_request</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">inference_response</span><span class="o">.</span><span class="n">visualization</span><span class="p">,</span>
                    <span class="n">media_type</span><span class="o">=</span><span class="s2">"image/jpeg"</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">inference_response</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>
        <span class="c1"># Legacy clear cache endpoint for backwards compatability</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/clear_cache"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_clear_cache</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Clears the model cache.</span>

<span class="sd">            This endpoint provides a way to clear the cache of loaded models.</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: A string indicating that the cache has been cleared.</span>
<span class="sd">            """</span>
            <span class="k">await</span> <span class="n">model_clear</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">"Cache Cleared"</span>

        <span class="c1"># Legacy add model endpoint for backwards compatability</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/start/</span><span class="si">{dataset_id}</span><span class="s2">/</span><span class="si">{version_id}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Starts a model inference session.</span>

<span class="sd">            This endpoint initializes and starts an inference session for the specified model version.</span>

<span class="sd">            Args:</span>
<span class="sd">                dataset_id (str): ID of a Roboflow dataset corresponding to the model.</span>
<span class="sd">                version_id (str): ID of a Roboflow dataset version corresponding to the model.</span>
<span class="sd">                api_key (str, optional): Roboflow API Key for artifact retrieval.</span>

<span class="sd">            Returns:</span>
<span class="sd">                JSONResponse: A response object containing the status and a success message.</span>
<span class="sd">            """</span>
            <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">"status"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"inference session started from local memory."</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Roboflow 2023. All rights reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/roboflow" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://www.youtube.com/roboflow" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/company/roboflow-ai/mycompany/" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/roboflow" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": 1.0}}</script>
<script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>